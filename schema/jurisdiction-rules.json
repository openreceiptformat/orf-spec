{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://openreceipt.org/schema/jurisdiction-rules-0.1.json",
  "title": "ORF Jurisdiction-Specific Validation Rules",
  "description": "Validation rules for jurisdiction-specific extensions in Open Receipt Format",
  "type": "object",
  "definitions": {
    "mx_cfdi_rules": {
      "type": "object",
      "description": "Mexico - CFDI (Comprobante Fiscal Digital por Internet) validation rules",
      "required": ["version", "uuid", "pac_provider", "sat_status"],
      "properties": {
        "version": {
          "type": "string",
          "enum": ["3.3", "4.0"],
          "description": "CFDI schema version"
        },
        "uuid": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
          "description": "Folio fiscal (UUID format)"
        },
        "folio_fiscal": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
          "description": "Alternative field name for UUID"
        },
        "pac_provider": {
          "type": "string",
          "minLength": 1,
          "description": "Authorized PAC provider name"
        },
        "pac_stamp_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when PAC stamped the CFDI"
        },
        "certificate_number": {
          "type": "string",
          "pattern": "^[0-9]{20}$",
          "description": "20-digit certificate number"
        },
        "sat_certificate": {
          "type": "string",
          "pattern": "^[0-9]{20}$",
          "description": "SAT certificate number"
        },
        "original_string": {
          "type": "string",
          "description": "Original string used for digital signature"
        },
        "sat_stamp": {
          "type": "string",
          "description": "Digital signature from SAT"
        },
        "sat_status": {
          "type": "string",
          "enum": ["VIGENTE", "CANCELADO", "NO_ENCONTRADO"],
          "description": "SAT verification status"
        },
        "qr_code_url": {
          "type": "string",
          "format": "uri",
          "description": "URL for QR code verification"
        },
        "xml_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to download full CFDI XML"
        }
      },
      "additionalProperties": true
    },
    
    "br_nfe_rules": {
      "type": "object",
      "description": "Brazil - NF-e/NFC-e (Nota Fiscal Eletrônica) validation rules",
      "required": ["model", "access_key", "authorization_protocol"],
      "properties": {
        "model": {
          "type": "string",
          "enum": ["55", "65"],
          "description": "55=NF-e (regular), 65=NFC-e (consumer)"
        },
        "series": {
          "type": "string",
          "pattern": "^[0-9]{1,3}$",
          "description": "Series number (1-3 digits)"
        },
        "number": {
          "type": "string",
          "pattern": "^[0-9]{1,9}$",
          "description": "Invoice number (1-9 digits)"
        },
        "access_key": {
          "type": "string",
          "pattern": "^[0-9]{44}$",
          "description": "44-digit chave de acesso (access key)"
        },
        "authorization_protocol": {
          "type": "string",
          "pattern": "^[0-9]{15}$",
          "description": "15-digit SEFAZ authorization protocol number"
        },
        "authorization_timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of SEFAZ authorization"
        },
        "digest_value": {
          "type": "string",
          "description": "SHA-1 digest of the XML"
        },
        "qr_code_url": {
          "type": "string",
          "format": "uri",
          "description": "URL for QR code verification"
        },
        "qr_code_data": {
          "type": "string",
          "description": "Raw QR code data string"
        },
        "xml_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to download full NF-e XML"
        },
        "danfe_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to download DANFE PDF"
        }
      },
      "additionalProperties": true
    },
    
    "eu_vat_rules": {
      "type": "object",
      "description": "European Union - VAT Directive compliance validation rules",
      "required": ["invoice_type", "member_state"],
      "properties": {
        "invoice_type": {
          "type": "string",
          "enum": ["COMMERCIAL_INVOICE", "CREDIT_NOTE", "DEBIT_NOTE", "SIMPLIFIED_INVOICE"],
          "description": "Type of VAT invoice"
        },
        "member_state": {
          "type": "string",
          "pattern": "^[A-Z]{2}$",
          "description": "ISO 3166-1 alpha-2 country code of issuing member state"
        },
        "reverse_charge": {
          "type": "boolean",
          "description": "Whether reverse charge mechanism applies"
        },
        "intra_community_supply": {
          "type": "boolean",
          "description": "Whether this is an intra-EU B2B transaction"
        },
        "vat_breakdown": {
          "type": "array",
          "minItems": 1,
          "description": "Detailed VAT breakdown by rate",
          "items": {
            "type": "object",
            "required": ["rate", "taxable_amount", "vat_amount", "category"],
            "properties": {
              "rate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "VAT rate as decimal (e.g., 0.19 for 19%)"
              },
              "taxable_amount": {
                "type": "number",
                "minimum": 0,
                "description": "Base amount before VAT"
              },
              "vat_amount": {
                "type": "number",
                "minimum": 0,
                "description": "VAT amount charged"
              },
              "category": {
                "type": "string",
                "enum": ["STANDARD_RATE", "REDUCED_RATE", "SUPER_REDUCED_RATE", "ZERO_RATE", "EXEMPT", "REVERSE_CHARGE"],
                "description": "VAT rate category"
              }
            }
          }
        },
        "payment_terms": {
          "type": "string",
          "description": "Payment terms (e.g., NET_30)"
        },
        "invoice_currency_exchange_rate": {
          "type": ["number", "null"],
          "description": "Exchange rate if invoice currency differs from functional currency"
        }
      },
      "additionalProperties": true
    },
    
    "us_sales_tax_rules": {
      "type": "object",
      "description": "United States - State and local sales tax validation rules",
      "required": ["state", "nexus"],
      "properties": {
        "state": {
          "type": "string",
          "pattern": "^[A-Z]{2}$",
          "description": "2-letter state abbreviation (e.g., CA, TX, NY)"
        },
        "local_jurisdiction": {
          "type": "string",
          "description": "Name of local tax jurisdiction (city, county)"
        },
        "jurisdiction_code": {
          "type": "string",
          "description": "State-specific jurisdiction code for tax reporting"
        },
        "nexus": {
          "type": "boolean",
          "description": "Whether merchant has physical or economic nexus in this state"
        },
        "tax_breakdown": {
          "type": "array",
          "description": "Breakdown of state and local taxes",
          "items": {
            "type": "object",
            "required": ["type", "rate", "amount"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["STATE", "LOCAL", "COUNTY", "CITY", "DISTRICT", "SPECIAL"],
                "description": "Type of sales tax"
              },
              "rate": {
                "type": "number",
                "minimum": 0,
                "maximum": 0.15,
                "description": "Tax rate as decimal"
              },
              "amount": {
                "type": "number",
                "minimum": 0,
                "description": "Tax amount in currency"
              }
            }
          }
        },
        "exemption_certificate": {
          "type": ["string", "null"],
          "description": "Reference number for tax exemption certificate if applicable"
        },
        "streamlined_sales_tax": {
          "type": "boolean",
          "description": "Whether merchant is registered under Streamlined Sales Tax agreement"
        }
      },
      "additionalProperties": true
    },
    
    "cn_fapiao_rules": {
      "type": "object",
      "description": "China - Fapiao (发票) validation rules",
      "required": ["fapiao_type", "fapiao_code", "fapiao_number", "verification_code"],
      "properties": {
        "fapiao_type": {
          "type": "string",
          "enum": ["VAT_SPECIAL", "VAT_ORDINARY", "E_FAPIAO", "QUOTA_INVOICE"],
          "description": "Type of Fapiao"
        },
        "fapiao_code": {
          "type": "string",
          "pattern": "^[0-9]{10}$",
          "description": "10-digit Fapiao code assigned by tax authority"
        },
        "fapiao_number": {
          "type": "string",
          "pattern": "^[0-9]{8}$",
          "description": "8-digit sequential Fapiao number"
        },
        "issue_date": {
          "type": "string",
          "format": "date",
          "description": "Date of issue (YYYY-MM-DD)"
        },
        "verification_code": {
          "type": "string",
          "pattern": "^[0-9]{20}$",
          "description": "20-digit verification code"
        },
        "machine_code": {
          "type": "string",
          "pattern": "^[0-9]{12}$",
          "description": "Tax control device identifier"
        },
        "qr_code_data": {
          "type": "string",
          "description": "QR code content for mobile verification"
        },
        "security_code": {
          "type": "string",
          "description": "Security code (may include special characters)"
        },
        "buyer_bank_account": {
          "type": "string",
          "description": "Buyer's bank account information"
        },
        "seller_bank_account": {
          "type": "string",
          "description": "Seller's bank account information"
        },
        "remarks": {
          "type": "string",
          "description": "Additional remarks or notes"
        },
        "drawer": {
          "type": "string",
          "description": "Name of person who drew the invoice"
        },
        "reviewer": {
          "type": "string",
          "description": "Name of person who reviewed the invoice"
        },
        "payee": {
          "type": "string",
          "description": "Name of person authorized to receive payment"
        },
        "electronic_signature": {
          "type": "string",
          "description": "Digital signature for e-Fapiao"
        },
        "xml_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to download full Fapiao XML"
        }
      },
      "additionalProperties": true
    },
    
    "in_gst_einvoice_rules": {
      "type": "object",
      "description": "India - GST e-Invoice validation rules",
      "required": ["version", "irn", "acknowledgement_number"],
      "properties": {
        "version": {
          "type": "string",
          "enum": ["1.0", "1.1"],
          "description": "e-Invoice schema version"
        },
        "irn": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{64}$",
          "description": "64-character hexadecimal Invoice Reference Number"
        },
        "acknowledgement_number": {
          "type": "string",
          "pattern": "^[0-9]{15}$",
          "description": "15-digit IRP acknowledgement number"
        },
        "acknowledgement_date": {
          "type": "string",
          "format": "date-time",
          "description": "IRP acknowledgement timestamp"
        },
        "signed_invoice": {
          "type": "string",
          "description": "JWT signed invoice payload"
        },
        "signed_qr_code": {
          "type": "string",
          "description": "Digitally signed QR code data"
        },
        "qr_code_url": {
          "type": "string",
          "format": "uri",
          "description": "URL for QR code image"
        },
        "irp_response": {
          "type": "object",
          "properties": {
            "status": {
              "type": "string",
              "enum": ["ACT", "CNL"],
              "description": "IRP status: ACT=Active, CNL=Cancelled"
            },
            "info_message": {
              "type": "string",
              "description": "IRP response message"
            }
          }
        },
        "supply_type": {
          "type": "string",
          "enum": ["B2B", "SEZWP", "SEZWOP", "EXPWP", "EXPWOP", "DEXP"],
          "description": "Type of supply"
        },
        "document_type": {
          "type": "string",
          "enum": ["INV", "CRN", "DBN"],
          "description": "INV=Invoice, CRN=Credit Note, DBN=Debit Note"
        },
        "reverse_charge": {
          "type": "string",
          "enum": ["Y", "N"],
          "description": "Reverse charge applicable: Y/N"
        },
        "place_of_supply": {
          "type": "string",
          "pattern": "^[0-9]{2}$",
          "description": "2-digit state code where supply occurs"
        },
        "hsn_code": {
          "type": "string",
          "pattern": "^[0-9]{4,8}$",
          "description": "Harmonized System of Nomenclature code"
        },
        "eway_bill_number": {
          "type": ["string", "null"],
          "pattern": "^[0-9]{12}$",
          "description": "12-digit e-Way Bill number if applicable"
        },
        "json_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to download full e-Invoice JSON"
        }
      },
      "additionalProperties": true
    },
    
    "jp_qualified_invoice_rules": {
      "type": "object",
      "description": "Japan - Qualified Invoice (適格請求書) validation rules",
      "required": ["invoice_type", "registration_number", "tax_rate_type"],
      "properties": {
        "invoice_type": {
          "type": "string",
          "enum": ["QUALIFIED_INVOICE", "SIMPLIFIED_INVOICE"],
          "description": "Type of invoice (full or simplified)"
        },
        "registration_number": {
          "type": "string",
          "pattern": "^T[0-9]{13}$",
          "description": "Qualified invoice issuer registration number (T + 13 digits)"
        },
        "issue_date": {
          "type": "string",
          "format": "date",
          "description": "Date of issue"
        },
        "transaction_date": {
          "type": "string",
          "format": "date",
          "description": "Date of transaction (may differ from issue date)"
        },
        "tax_rate_type": {
          "type": "string",
          "enum": ["STANDARD_10", "REDUCED_8", "EXEMPT", "MIXED"],
          "description": "Primary tax rate type applied"
        },
        "tax_breakdown": {
          "type": "array",
          "minItems": 1,
          "description": "Breakdown by tax rate",
          "items": {
            "type": "object",
            "required": ["rate", "category", "taxable_amount", "tax_amount"],
            "properties": {
              "rate": {
                "type": "number",
                "enum": [0.10, 0.08, 0],
                "description": "Tax rate: 0.10, 0.08, or 0"
              },
              "category": {
                "type": "string",
                "enum": ["STANDARD_RATE", "REDUCED_RATE", "EXEMPT"],
                "description": "Tax rate category"
              },
              "taxable_amount": {
                "type": "number",
                "minimum": 0,
                "description": "Amount before tax"
              },
              "tax_amount": {
                "type": "number",
                "minimum": 0,
                "description": "Consumption tax amount"
              }
            }
          }
        },
        "reduced_rate_items": {
          "type": "array",
          "description": "List of items subject to 8% reduced rate",
          "items": {
            "type": "string"
          }
        },
        "simplified_invoice": {
          "type": "boolean",
          "description": "Whether this is a simplified invoice (retail/restaurant)"
        },
        "remarks": {
          "type": "string",
          "description": "Additional remarks in Japanese"
        }
      },
      "additionalProperties": true
    },
    
    "au_tax_invoice_rules": {
      "type": "object",
      "description": "Australia - Tax Invoice validation rules",
      "required": ["document_type", "abn", "gst_amount"],
      "properties": {
        "document_type": {
          "type": "string",
          "enum": ["TAX_INVOICE", "RCTI", "ADJUSTMENT_NOTE"],
          "description": "Type of document"
        },
        "abn": {
          "type": "string",
          "pattern": "^[0-9]{2} [0-9]{3} [0-9]{3} [0-9]{3}$",
          "description": "Australian Business Number (11 digits with spaces)"
        },
        "gst_amount": {
          "type": "number",
          "minimum": 0,
          "description": "Total GST amount"
        },
        "contains_gst": {
          "type": "boolean",
          "description": "Whether the invoice contains GST"
        },
        "gst_free_items": {
          "type": "array",
          "description": "Line items that are GST-free",
          "items": {
            "type": "string"
          }
        },
        "input_taxed_items": {
          "type": "array",
          "description": "Line items that are input-taxed",
          "items": {
            "type": "string"
          }
        },
        "recipient_quote_rcti": {
          "type": "boolean",
          "description": "Whether this is a Recipient Created Tax Invoice"
        },
        "payment_terms": {
          "type": "string",
          "description": "Payment terms (e.g., NET 30)"
        },
        "bank_details": {
          "type": "object",
          "description": "Bank account details for payment",
          "properties": {
            "bsb": {
              "type": "string",
              "pattern": "^[0-9]{3}-[0-9]{3}$",
              "description": "BSB (Bank-State-Branch) number"
            },
            "account_number": {
              "type": "string",
              "pattern": "^[0-9]{6,9}$",
              "description": "Bank account number"
            },
            "account_name": {
              "type": "string",
              "description": "Account holder name"
            }
          }
        }
      },
      "additionalProperties": true
    },
    
    "kr_etax_invoice_rules": {
      "type": "object",
      "description": "South Korea - E-Tax Invoice (전자세금계산서) validation rules",
      "required": ["invoice_type", "approval_number", "supplier_registration_number", "buyer_registration_number"],
      "properties": {
        "invoice_type": {
          "type": "string",
          "enum": ["GENERAL", "MODIFIED", "FINAL"],
          "description": "Type of tax invoice"
        },
        "approval_number": {
          "type": "string",
          "pattern": "^[0-9]{8}-[0-9]{12}-[0-9]{8}$",
          "description": "NTS approval number format: YYYYMMDD-############-########"
        },
        "issue_type": {
          "type": "string",
          "enum": ["ISSUED", "RECEIPT_CONFIRMED", "NOT_CONFIRMED"],
          "description": "Issue and confirmation status"
        },
        "issue_date": {
          "type": "string",
          "pattern": "^[0-9]{8}$",
          "description": "Issue date in YYYYMMDD format"
        },
        "supplier_registration_number": {
          "type": "string",
          "pattern": "^[0-9]{3}-[0-9]{2}-[0-9]{5}$",
          "description": "Supplier's business registration number"
        },
        "supplier_name": {
          "type": "string",
          "description": "Supplier's legal name in Korean"
        },
        "supplier_ceo_name": {
          "type": "string",
          "description": "Supplier's CEO name"
        },
        "supplier_address": {
          "type": "string",
          "description": "Supplier's business address"
        },
        "supplier_business_type": {
          "type": "string",
          "description": "Supplier's business type classification"
        },
        "supplier_business_item": {
          "type": "string",
          "description": "Supplier's business item classification"
        },
        "buyer_registration_number": {
          "type": "string",
          "pattern": "^[0-9]{3}-[0-9]{2}-[0-9]{5}$",
          "description": "Buyer's business registration number"
        },
        "buyer_name": {
          "type": "string",
          "description": "Buyer's legal name"
        },
        "buyer_ceo_name": {
          "type": "string",
          "description": "Buyer's CEO name"
        },
        "supply_value": {
          "type": "number",
          "minimum": 0,
          "description": "Supply value before tax"
        },
        "tax_amount": {
          "type": "number",
          "minimum": 0,
          "description": "VAT amount (10% of supply value)"
        },
        "total_amount": {
          "type": "number",
          "minimum": 0,
          "description": "Total amount including tax"
        },
        "cash_amount": {
          "type": "number",
          "minimum": 0,
          "description": "Amount paid in cash"
        },
        "check_amount": {
          "type": "number",
          "minimum": 0,
          "description": "Amount paid by check"
        },
        "note_amount": {
          "type": "number",
          "minimum": 0,
          "description": "Amount paid by promissory note"
        },
        "credit_amount": {
          "type": "number",
          "minimum": 0,
          "description": "Amount on credit"
        },
        "remarks": {
          "type": "string",
          "description": "Additional remarks"
        },
        "nts_confirmation_number": {
          "type": "string",
          "pattern": "^[0-9]{16}$",
          "description": "National Tax Service confirmation number"
        },
        "nts_send_date": {
          "type": "string",
          "pattern": "^[0-9]{14}$",
          "description": "NTS transmission timestamp (YYYYMMDDHHmmss)"
        },
        "xml_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to download full e-Tax Invoice XML"
        }
      },
      "additionalProperties": true
    }
  }
}